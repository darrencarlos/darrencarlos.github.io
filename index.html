<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload to Firebase</title>
</head>
<body>
    <h1>Upload File to Firebase Storage</h1>
    <input type="file" id="fileInput" />
    <button id="uploadButton">Upload</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-storage.js";
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCyAIzm4QyPnxJ6LFM1gH4yos7Tqb3GcEc",
            authDomain: "offline-viewing-uat.firebaseapp.com",
            projectId: "offline-viewing-uat",
            storageBucket: "offline-viewing-uat.appspot.com",
            messagingSenderId: "953175688732",
            appId: "1:953175688732:web:5eb2df67945a76844a81d9"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);

        alert('Firebase initialized!');

        document.getElementById('uploadButton').addEventListener('click', () => {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0]; // Get the selected file

            if (file) {
                // Create a storage reference for the file
                const storageRef = ref(storage, 'videos/' + file.name); // 'videos/' folder in Firebase Storage

                // Upload the file
                const uploadTask = uploadBytesResumable(storageRef, file);

                // Monitor the upload progress
                uploadTask.on('state_changed',
                    (snapshot) => {
                        // Calculate the upload progress
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        console.log('Upload is ' + progress + '% done');
                    },
                    (error) => {
                        // Handle errors during upload
                        console.error('Upload failed:', error);
                    },
                    () => {
                        // Get the download URL after a successful upload
                        getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
                            console.log('File available at:', downloadURL);
                            alert('File uploaded successfully! Download URL: ' + downloadURL);
                        });
                    }
                );
            } else {
                alert('No file selected!');
            }
        });
    </script>
</body>
</html>